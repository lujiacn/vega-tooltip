"use strict";!function(){function t(t,o){var a=[],r=o.config?o.config.timeFormat:void 0,l=o.config?o.config.numberFormat:void 0;return t.showAllFields!==!1?vl.spec.fieldDefs(o).forEach(function(i){var o=e(t.fields,i),f=n(o,i,r,l);a.push(f)}):t.fields&&t.fields.length>0&&t.fields.forEach(function(t){var e=i(vl.spec.fieldDefs(o),t),f=n(t,e,r,l);a.push(f)}),t.fields=a,t}function e(t,e){if(e&&t&&!(t.length<=0))if(e.aggregate){for(var i=0;i<t.length;i++){var n=t[i];if(n.field===e.field&&n.aggregate===e.aggregate)return n}for(var i=0;i<t.length;i++){var n=t[i];if(n.field===e.field&&!n.aggregate)return n}}else for(var i=0;i<t.length;i++){var n=t[i];if(n.field===e.field)return n}}function i(t,e){if(e&&e.field&&t)for(var i=0;i<t.length;i++){var n=t[i];if(n.field===e.field){if(!n.aggregate)return n;if(n.aggregate===e.aggregate||!e.aggregate)return n}}}function n(t,e,i,n){if(!t&&!e)return void console.error("[Tooltip] Cannot supplement a field when field and fieldDef are both empty.");!t&&e&&(t={}),t&&!e&&(e={});var o={};if(o.field=e.field?vl.fieldDef.field(e):t.field,o.title=t.title?t.title:vl.fieldDef.title(e),o.formatType=t.formatType?t.formatType:T[e.type],t.format)o.format=t.format;else switch(o.formatType){case"time":o.format=e.timeUnit?vl.timeUnit.template(e.timeUnit,"",!1).match(/time:'[%-a-z]*'/i)[0].split("'")[1]:i;break;case"number":o.format=n;break;case"string":}return e.bin&&(o.field=o.field.replace("_start","_range"),o.bin=!0,o.formatType="string"),o}function o(t,e,i){if(l(e)!==!1){var n=h(),o=f(e,i);o&&0!==o.length&&(y(n,o),b(t,i),_(i),d3.select("#vis-tooltip").style("display","block"))}}function a(t,e,i){b(t,i)}function r(){w(),x(),d3.select("#vis-tooltip").style("display","none")}function l(t){return!(!t||!t.datum)&&(!t.datum._facetID&&!!t.datum._id)}function f(t,e){var i,n=d3.map(t.datum),o=["_id","_prev","count_start","count_end","layout_start","layout_mid","layout_end","layout_path","layout_x","layout_y"];return c(n,o),v(n,e.fields),m(t.mark.marktype,n),i=e.showAllFields!==!1?d(n,e):s(n,e)}function s(t,e){var i=[];return e.fields.forEach(function(e){var n=e.title?e.title:e.field,o=u(t,e.field);if(void 0!==o){var a=p(o,e.formatType,e.format)||g(o);i.push({title:n,value:a})}}),i}function u(t,e){var i,n=e.split("."),o=n[0];return n.shift(),t.has(o)&&(i=t.get(o),n.forEach(function(t){i[t]&&(i=i[t])})),void 0===i?void console.warn("[Tooltip] Cannot find field "+e+" in data."):i}function d(t,e){var i=[],n=d3.map(e.fields,function(t){return t.field});return t.forEach(function(t,e){var o;if(o=n.has(t)&&n.get(t).title?n.get(t).title:t,n.has(t))var a=n.get(t).formatType,r=n.get(t).format;var l=p(e,a,r)||g(e);i.push({title:o,value:l})}),i}function c(t,e){e.forEach(function(e){t.remove(e)})}function v(t,e){if(e)return e.forEach(function(e){if(e.bin===!0){var i=e.field,n=i.replace("_range","_start"),o=i.replace("_range","_mid"),a=i.replace("_range","_end"),r=t.get(n),l=t.get(a);if(void 0!==r&&void 0!==l){var f=r+"-"+l;t.set(i,f)}var s=[];s.push(n,o,a),c(t,s)}}),t}function m(t,e){if("line"===t||"area"===t){console.warn("[Tooltip]: By default, we only show qualitative data for "+t+" charts.");var i=[];e.forEach(function(t,e){switch(dl.type(e)){case"number":case"date":i.push(t);break;case"boolean":case"string":}}),c(e,i)}}function p(t,e,i){if(void 0!==t&&null!==t&&e)switch(e){case"time":return i?dl.format.time(i)(t):dl.format.auto.time()(t);case"number":return i?dl.format.number(i)(t):dl.format.auto.number()(t);case"string":default:return t}}function g(t){switch(dl.type(t)){case"date":return dl.format.auto.time()(t);case"number":return dl.format.auto.number()(t);case"boolean":case"string":default:return t}}function h(){var t;return t=d3.select("#vis-tooltip").empty()?d3.select("body").append("div").attr("id","vis-tooltip"):d3.select("#vis-tooltip")}function y(t,e){var i=t.append("table").selectAll(".tooltip-row").data(e);i.exit().remove();var n=i.enter().append("tr").attr("class","tooltip-row");n.append("td").attr("class","key").text(function(t){return t.title+":"}),n.append("td").attr("class","value").text(function(t){return t.value})}function w(){d3.select("#vis-tooltip").selectAll(".tooltip-row").data([]).exit().remove()}function b(t,e){var i=10,n=10;e&&e.offset&&void 0!==e.offset.x&&null!==e.offset.x&&(i=e.offset.x),e&&e.offset&&void 0!==e.offset.y&&null!==e.offset.y&&(n=e.offset.y),d3.select("#vis-tooltip").style("top",function(){var e=parseInt(d3.select(this).style("height"));return t.clientY+e+n<window.innerHeight?""+(t.clientY+n)+"px":""+(t.clientY-e-n)+"px"}).style("left",function(){var e=parseInt(d3.select(this).style("width"));return t.clientX+e+i<window.innerWidth?""+(t.clientX+i)+"px":""+(t.clientX-e-i)+"px"})}function _(t){x(),t&&"dark"===t.colorTheme?d3.select("#vis-tooltip").classed("dark-theme",!0):d3.select("#vis-tooltip").classed("light-theme",!0)}function x(){d3.select("#vis-tooltip").classed("dark-theme light-theme",!1)}window.vg=window.vg||{},window.vg.tooltip=function(t,e){e||(e={}),t.on("mouseover",function(t,i){o(t,i,e)}),t.on("mousemove",function(t,i){a(t,i,e)}),t.on("mouseout",function(t,e){r()})},window.vl=window.vl||{},window.vl.tooltip=function(e,i,n){n||(n={}),n=t(n,i),e.on("mouseover",function(t,e){o(t,e,n)}),e.on("mousemove",function(t,e){a(t,e,n)}),e.on("mouseout",function(t,e){r()})};var T={quantitative:"number",temporal:"time",ordinal:void 0,nominal:void 0}}();
